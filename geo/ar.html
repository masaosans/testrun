<!DOCTYPE html>
<html>
<head>
  <title>AR モード</title>
  <meta name="viewport" content="initial-scale=1.0,viewport-fit=cover"> <!-- Android対応 -->
  <style>
    #arButton {
      position: absolute; /* 画面のどこにでも配置できるように */
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }

    #arButton:hover {
      background-color: #3e8e41;
    }

    #arContainer {
        width: 100%; /*画面全体を占有 */
        height: 100vh;  /*画面全体を占有 */
    }
  </style>
</head>
<body>

  <button id="arButton">AR モードを起動</button>

  <div id="arContainer">
      <!-- ここに Three.js の AR コンテンツをレンダリング -->
  </div>


  <script>
    // ARモードの制御
    let arMode = false;
    let threejsScene; // Three.js シーンを保持する変数

    const arButton = document.getElementById('arButton');
    const arContainer = document.getElementById('arContainer');

    arButton.addEventListener('click', () => {
      if (!arMode) {
        startARMode();
      } else {
        endARMode();
      }
    });


    function startARMode() {
      arMode = true;
      arButton.textContent = "AR モード終了";

       // Three.js シーンの作成 (Three.jsが読み込まれていることを前提)
      threejsScene = new THREE.Scene();
      threejsScene.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100); // カメラを設定

      // AR コンテンツのロードと設定 (Three.js でオブジェクトを生成する処理を記述)
      loadARContent();

      arContainer.appendChild(threejsScene.renderingContext);  // レンダリングコンテキストを追加。これは Three.js がコンテンツを表示するために必要なものです。


    }



    function endARMode() {
      arMode = false;
      arButton.textContent = "AR モードを起動";

       // Three.js シーンの破棄
      if (threejsScene) {
        // threejsScene.dispose(); // リソースを解放する処理。必須ではないが推奨
        arContainer.innerHTML = ''; //コンテナ内をクリア
        threejsScene = null;
      }

    }


    function loadARContent() {
      // ここで Three.js で AR コンテンツをロード、設定します。
      // 例:  オブジェクトの作成と配置
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 }); // 緑色
      const box = new THREE.Mesh(geometry, material);

      threejsScene.add(box);


      //画面タップ時のオブジェクト生成処理を実装します。
       window.addEventListener('click', () => {
           generateObject(window.mouseX, window.mouseY); //マウスの位置を取得してオブジェクトを生成
       });
    }



   function generateObject(x, y) {
        const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
        const material = new THREE.MeshBasicMaterial({ color: 0xff0000 }); // 赤色

        const obj = new THREE.Mesh(geometry, material);
        obj.position.set(x, y, 0);  //オブジェクトの位置を設定
        threejsScene.add(obj);
    }




  </script>

  <!-- Three.js を読み込む (CDN またはローカルファイル) -->
  <script src="https://threejs.org/build/three.js"></script>

</body>
</html>